# 出厂系统的安装

## 1. uboot

* 找到路径

`D:\嵌入式学习资料\【正点原子】阿尔法Linux开发板（A盘）-基础资料\【正点原子】阿尔法Linux开发板（A盘）-基础资料\08、系统镜像\08、系统镜像\01、出厂系统镜像\01、u-boot镜像\uboot-imx-2016.03-2.1.0-g0ae7e33-v1.7`

* 选择 uboot 二进制文件

`u-boot-imx6ull-14x14-ddr512-emmc`

* 使用 imx6ulldownload 文件将 uboot 二进制文件下载到 sd 卡

## 2. 系统镜像与设备树

* 找到路径，选择 zImage 和 imx6ull-14x14-emmc-4.3-800x480-c.dtb

`D:\嵌入式学习资料\【正点原子】阿尔法Linux开发板（A盘）-基础资料\【正点原子】阿尔法Linux开发板（A盘）-基础资料\08、系统镜像\08、系统镜像\01、出厂系统镜像\02、kernel镜像\linux-imx-4.1.15-2.1.0-g3dc0a4b-v2.7`

* 创建文件夹，作为 tftp 的路径，比如 `~/app_dev_system/tftp/`，将系统镜像和设备树文件复制到该目录下

**配置 tftp**

* 修改 `sudo vim /etc/default/tftpd-hpa`，将 tftp 路径修改为上述路径，这个配置文件针对的是默认的 tftp 配置

```sh
# /etc/default/tftpd-hpa

TFTP_USERNAME="tftp"
TFTP_DIRECTORY="/home/xggui/app_dev_system/tftp"
TFTP_ADDRESS=":69"
TFTP_OPTIONS="-l -c -s"
```

> 关于 /etc/xinetd.d/tftp 的配置文件：
>
> 这个配置文件是针对特定的服务器进行配置的

**重启 tftp 服务**

```sh
sudo service tftpd-hpa restart
```

**配置 uboot 环境变量**

```sh
bootcmd=tftp 80800000 zImage; tftp 83000000 imx6ull-14x14-emmc-4.3-800x480-c.dtb; bootz 80800000 - 83000000
fdt_file=imx6ull-14x14-emmc-4.3-800x480-c.dtb
```

## 3. 文件系统

**配置 nfs **

创建一个 nfs 文件夹 `/home/xggui/app_dev_system/nfs`，修改配置文件 `sudo vim /etc/exports`

添加如下：

```sh
# /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
#
# Example for NFSv2 and NFSv3:
# /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)
#
# Example for NFSv4:
# /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)
# /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)
#

/home/xggui/linux/nfs *(rw,sync,no_root_squash)
/home/xggui/app_dev_system/nfs *(rw,sync,no_root_squash)
```

重启 nfs `sudo /etc/init.d/nfs-kernel-server restart `

* 找到路径 `D:\嵌入式学习资料\【正点原子】阿尔法Linux开发板（A盘）-基础资料\【正点原子】阿尔法Linux开发板（A盘）-基础资料\08、系统镜像\08、系统镜像\01、出厂系统镜像\03、文件系统` 选择文件 `rootfs.tar.bz2`
* 解压文件到 nfs 文件夹

**配置 uboot环境变量**

```sh
bootargs=console=tty1 console=ttymxc0,115200 root=/dev/nfs nfsroot=192.168.1.7:/home/xggui/app_dev_system/nfs/rootfs,proto=tcp rw ip=192.168.1.22:192.168.1.7:192.168.1.1:255.255.255.0::eth0:off
```

